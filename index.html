<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Marvel Marathon</title>

<!-- PWA meta -->
<meta name="theme-color" content="#e62429" />
<link rel="manifest" href="manifest.webmanifest" />
<link rel="apple-touch-icon" href="icons/icon-180.png" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Marvel Marathon" />

<style>
    :root { --accent:#e62429; }
    html, body {
        margin: 0; padding: 0; background:#111; color:#fff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    }
    header {
        position: sticky; top: 0; z-index: 2;
        background: var(--accent);
        padding: env(safe-area-inset-top) 16px 12px 16px;
        text-align:center; font-weight: 800; letter-spacing: .2px;
    }
    .container { max-width: 720px; margin: 0 auto; padding: 12px; }
    .movie {
        display:flex; gap:12px; align-items:flex-start; padding:12px; border-bottom:1px solid #2a2a2a;
    }
    .movie input { transform: scale(1.3); margin-top: 4px; }
    .title { font-weight:700; color:#ffd700; }
    .why { color:#cfcfcf; font-size:.92rem; line-height:1.3rem; }
    .watched .title, .watched .why { color:#7a7a7a; text-decoration: line-through; }
    .controls {
        position: sticky; bottom: 0; z-index: 2;
        background: linear-gradient(0deg, #111, rgba(17,17,17,0.7));
        padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
        display:flex; gap:10px; justify-content:center;
    }
    button {
        background: var(--accent); color:white; border:none; padding:10px 16px;
        border-radius:10px; font-weight:700; cursor:pointer;
    }
    button:active { transform: translateY(1px); }
    .progress { text-align:center; margin:10px 0 4px; color:#d9d9d9; font-size:.95rem; }
    .install-hint {
        background:#1b1b1b; border:1px solid #2a2a2a; border-radius:10px; padding:10px 12px; margin:10px;
        font-size:.95rem; display:none;
    }
    a { color:#66c0ff; }
</style>
</head>
<body>
<header>Marvel Marathon Checklist</header>
<div class="container">
  <div id="installHint" class="install-hint">
    Tip: To install on iPhone, tap <b>Share</b> → <b>Add to Home Screen</b>. Then open it from your Home Screen like an app.
  </div>
  <div id="progress" class="progress">Loading…</div>
  <div id="movie-list" aria-live="polite"></div>
</div>

<div class="controls">
  <button id="btnReset" type="button">Reset</button>
  <button id="btnShare" type="button">Share Progress</button>
</div>

<script>
// Register service worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js').catch(console.error);
  });
}

// Install hint for iOS (no native prompt)
(function showIOSInstallHint(){
  const ua = window.navigator.userAgent.toLowerCase();
  const isIOS = /iphone|ipad|ipod/.test(ua);
  const isInStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
  if (isIOS && !isInStandalone) {
    document.getElementById('installHint').style.display = 'block';
  }
})();

const movies = [
    {title: "Captain America: The First Avenger", why: "Origin of Cap + Tesseract (Space Stone)"},
    {title: "Iron Man", why: "Stark’s journey begins"},
    {title: "Thor", why: "Introduces Thor, Loki, Asgard, Bifrost"},
    {title: "The Avengers", why: "Heroes unite, Loki returns, Thanos teased"},
    {title: "Captain America: The Winter Soldier", why: "S.H.I.E.L.D. collapse, Hydra revealed"},
    {title: "Guardians of the Galaxy", why: "Power Stone + Cosmic side + Thanos"},
    {title: "Guardians of the Galaxy Vol. 2", why: "Continues Guardians’ story + Ego the Celestial"},
    {title: "Avengers: Age of Ultron", why: "Mind Stone, Scarlet Witch, Vision"},
    {title: "Captain America: Civil War", why: "Avengers split + intro: Black Panther & Spider-Man"},
    {title: "Black Panther", why: "Wakanda’s leadership and tech"},
    {title: "Spider-Man: Homecoming", why: "Peter’s growth post-Civil War"},
    {title: "Doctor Strange", why: "Magic + Time Stone + multiverse hint"},
    {title: "Thor: Ragnarok", why: "Asgard destroyed, leads into Infinity War"},
    {title: "Avengers: Infinity War", why: "Thanos collects the Stones, universe snapped"},
    {title: "Avengers: Endgame", why: "Time heist, multiverse begins, huge turning point"},
    {title: "Spider-Man: Far From Home", why: "Post-Endgame grief + Mysterio illusion"},
    {title: "WandaVision", why: "Wanda transforms into Scarlet Witch"},
    {title: "Loki (Season 1)", why: "Multiverse unleashed + Kang variants introduced"},
    {title: "Spider-Man: No Way Home", why: "Real multiverse chaos, all 3 Spider-Men"},
    {title: "Doctor Strange in the Multiverse of Madness", why: "Multiverse war begins + Wanda’s arc ends"},
    {title: "Black Panther: Wakanda Forever", why: "Wakanda post-T’Challa + Namor intro"},
    {title: "Ant-Man and the Wasp: Quantumania", why: "Full Kang reveal + Multiverse threat escalates"},
    {title: "Guardians of the Galaxy Vol. 3", why: "Guardians’ final arc, Rocket’s backstory"}
];

const STORAGE_KEY = "marvelChecklistV2";
const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");

const listContainer = document.getElementById("movie-list");
const progressEl = document.getElementById("progress");

function render() {
  listContainer.innerHTML = "";
  let watchedCount = 0;

  movies.forEach((movie, index) => {
    const row = document.createElement("div");
    row.className = "movie" + (saved[index] ? " watched" : "");

    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = !!saved[index];
    checkbox.id = "mv-" + index;
    checkbox.addEventListener("change", () => {
      saved[index] = checkbox.checked;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
      render();
    });

    const textWrap = document.createElement("label");
    textWrap.setAttribute("for", checkbox.id);
    const title = document.createElement("div");
    title.className = "title";
    title.textContent = (index+1) + ". " + movie.title;
    const why = document.createElement("div");
    why.className = "why";
    why.textContent = movie.why;

    textWrap.appendChild(title);
    textWrap.appendChild(why);

    row.appendChild(checkbox);
    row.appendChild(textWrap);
    listContainer.appendChild(row);

    if (checkbox.checked) watchedCount++;
  });

  progressEl.textContent = `Progress: ${watchedCount}/${movies.length} • ${Math.round((watchedCount/movies.length)*100)}%`;
}

document.getElementById("btnReset").addEventListener("click", () => {
  if (confirm("Reset your checklist? This clears local progress.")) {
    localStorage.removeItem(STORAGE_KEY);
    for (const k in saved) delete saved[k];
    render();
  }
});

document.getElementById("btnShare").addEventListener("click", async () => {
  const data = {
    watched: movies.map((_, i) => !!saved[i]),
    ts: new Date().toISOString()
  };
  const text = `Marvel Marathon Progress:\n` + data.watched.map((v,i)=>`${i+1}. ${movies[i].title} — ${v?'✅ Watched':'⬜️ Not yet'}`).join('\n');
  if (navigator.share) {
    try { await navigator.share({ text }); } catch (e) {}
  } else {
    await navigator.clipboard.writeText(text);
    alert("Progress copied to clipboard!");
  }
});

render();
</script>

</body>
</html>
